{% extends "base_detail.html" %}
{% load i18n static crispy_forms_tags %}

{% block head_title %}
{{ title }}
{% endblock head_title %}

{% block extrastyle %}
{{ block.super }}
{% if cl.formset %}
<link rel="stylesheet" type="text/css" href="{% static "admin/css/forms.css" %}"/>
{% endif %}
{% if cl.formset or action_form %}
<script src="{% url 'admin:jsi18n' %}"></script>
{% endif %}
{{ media.css }}
{% if not actions_on_top and not actions_on_bottom %}
<style>
#changelist table thead th:first-child {width: inherit}
</style>
{% endif %}
{% endblock extrastyle %}

{% block extrahead %}
{{ block.super }}
{{ word_formset.media }}
{% endblock extrahead %}

{% block bodyclass %}
{{ block.super }}
{% endblock bodyclass %}

{% block object-tools %}
{% if not is_popup %}
<div class="flex items-center md:justify-end p-3 md:px-10 gap-2">
<ul class="object-tools mt-0">
{% block object-tools-items %}

{% endblock object-tools-items %}
</ul>
</div>
{% endif %}
{% endblock object-tools %}

{% block content %}

<main class="relative pt-16 bg-slate-100 min-h-screen">
	<div class="container w-full mx-auto">
		<div class="relative lg:pt-5 pb-6 pt-12 flex title-block">
			<div class="px-4 lg:px-10 mx-auto w-full">
				<h1 class="font-normal text-xl md:text-2xl">Add course</h1>
				<hr class="md:min-w-full" />
				<div class="breadcrumbs">
					<a href="/">Home</a>
					&rsaquo; <a href="/course/">Course</a>
					&rsaquo; Add course
				</div>
			</div>
		</div>
		<div class="px-4 lg:px-10 mx-auto w-full">
			<div class="w-full pb-12">
				<div id="content-main">
					<div class="pager flex justify-end">
						<div class="block"></div>
					</div>
					<form method="POST" action="" id="course_form" enctype="multipart/form-data">
					{% csrf_token %}
					{{ word_formset.management_form }}

						<div>

							{% if total_level == 0 %}

							<div class="submit-row">
								<input type="submit" value="Save" class="default" name="_save">
							</div>

							<fieldset class="module aligned shadow-lg rounded">
								<h2 class="px-3">Course</h2>
								<div class="form-row field-id">
									<div>
										<label class="required" for="id_id">Id:</label>
										{{ formA.id|as_crispy_field }}
									</div>
								</div>
								<div class="form-row field-name">
									<div>
										<label class="required" for="id_name">Name:</label>
										{{ formA.name|as_crispy_field }}
									</div>
								</div>
								<div class="form-row field-native">
									<div>
										<label class="required" for="id_native">Native:</label>
										<div class="related-widget-wrapper" data-model-ref="language">
											{{ formA.native|as_crispy_field }}
											<a class="related-widget-wrapper-link change-related" id="change_id_native" data-href-template="/config/language/__fk__/change/" data-popup="yes" title="Change selected language">
												<img src="/static/admin/img/icon-changelink.svg" alt="Change">
											</a>
											<a class="related-widget-wrapper-link add-related" id="add_id_native" data-popup="yes" href="/config/language/add/" title="Add another language">
												<img src="/static/admin/img/icon-addlink.svg" alt="Add">
											</a>
											<a class="related-widget-wrapper-link delete-related" id="delete_id_native" data-href-template="/config/language/__fk__/delete/" data-popup="yes" title="Delete selected language">
												<img src="/static/admin/img/icon-deletelink.svg" alt="Delete">
											</a>
											<a class="related-widget-wrapper-link view-related" id="view_id_native" data-href-template="/config/language/__fk__/change/?_to_field=id" title="View selected language">
												<img src="/static/admin/img/icon-viewlink.svg" alt="View">
											</a>
										</div>
									</div>
								</div>
								<div class="form-row field-foreign">
									<div>
										<label class="required" for="id_foreign">Foreign:</label>
										<div class="related-widget-wrapper" data-model-ref="language">
											{{ formA.foreign|as_crispy_field }}
											<a class="related-widget-wrapper-link change-related" id="change_id_foreign" data-href-template="/config/language/__fk__/change/" data-popup="yes" title="Change selected language">
												<img src="/static/admin/img/icon-changelink.svg" alt="Change">
											</a>
											<a class="related-widget-wrapper-link add-related" id="add_id_foreign" data-popup="yes" href="/config/language/add/" title="Add another language">
												<img src="/static/admin/img/icon-addlink.svg" alt="Add">
											</a>
											<a class="related-widget-wrapper-link delete-related" id="delete_id_foreign" data-href-template="/config/language/__fk__/delete/" data-popup="yes" title="Delete selected language">
												<img src="/static/admin/img/icon-deletelink.svg" alt="Delete">
											</a>
											<a class="related-widget-wrapper-link view-related" id="view_id_foreign" data-href-template="/config/language/__fk__/change/?_to_field=id" title="View selected language">
												<img src="/static/admin/img/icon-viewlink.svg" alt="View">
											</a>
										</div>
									</div>
								</div>
								<div class="form-row field-description">
									<div>
										<label for="id_description">Description:</label>
										{{ formA.description|as_crispy_field }}
									</div>
								</div>
								<div class="form-row field-image">
									<div>
										<label>Image:</label>
										<div class="readonly"></div>
									</div>
								</div>
								<div class="form-row field-img">
									<div>
										<label for="id_img">Img:</label>
										{{ formA.img|as_crispy_field }}
									</div>
								</div>
								<div class="form-row field-is_active">
									<div class="checkbox-row">
										{{ formA.is_active|as_crispy_field }}
										<label class="vCheckboxLabel" for="id_is_active"></label>
									</div>
								</div>
							</fieldset>

							<fieldset class="module aligned">
								<h2 class="px-3">Level</h2>
								<div class="form-row field-sequence">
									<div>
										<label class="required" for="id_sequence">Sequence:</label>
										{{ formB.sequence|as_crispy_field }}
									</div>
								</div>
								<div class="form-row field-name">
									<div>
										<label class="required" for="id_name">Name:</label>
										{{ formB.name|as_crispy_field }}
									</div>
								</div>
							</fieldset>

							<div class="submit-row">
								<input type="submit" value="Save" class="default" name="_save">
							</div>

							{% else %}

							<div class="submit-row">
								<input type="submit" value="Save" class="default" name="_save">
							</div>

							<fieldset class="module aligned shadow-lg rounded">
								<h2 class="px-3">Course</h2>
								<div class="form-row field-id">
									<div>
										<label class="required" for="id_id">Id:</label>
										{{ formA.id|as_crispy_field }}
									</div>
								</div>
								<div class="form-row field-name">
									<div>
										<label class="required" for="id_name">Name:</label>
										{{ formA.name|as_crispy_field }}
									</div>
								</div>
								<div class="form-row field-native">
									<div>
										<label class="required" for="id_native">Native:</label>
										<div class="related-widget-wrapper" data-model-ref="language">
											{{ formA.native|as_crispy_field }}
											<a class="related-widget-wrapper-link change-related" id="change_id_native" data-href-template="/config/language/__fk__/change/" data-popup="yes" title="Change selected language">
												<img src="/static/admin/img/icon-changelink.svg" alt="Change">
											</a>
											<a class="related-widget-wrapper-link add-related" id="add_id_native" data-popup="yes" href="/config/language/add/" title="Add another language">
												<img src="/static/admin/img/icon-addlink.svg" alt="Add">
											</a>
											<a class="related-widget-wrapper-link delete-related" id="delete_id_native" data-href-template="/config/language/__fk__/delete/" data-popup="yes" title="Delete selected language">
												<img src="/static/admin/img/icon-deletelink.svg" alt="Delete">
											</a>
											<a class="related-widget-wrapper-link view-related" id="view_id_native" data-href-template="/config/language/__fk__/change/?_to_field=id" title="View selected language">
												<img src="/static/admin/img/icon-viewlink.svg" alt="View">
											</a>
										</div>
									</div>
								</div>
								<div class="form-row field-foreign">
									<div>
										<label class="required" for="id_foreign">Foreign:</label>
										<div class="related-widget-wrapper" data-model-ref="language">
											{{ formA.foreign|as_crispy_field }}
											<a class="related-widget-wrapper-link change-related" id="change_id_foreign" data-href-template="/config/language/__fk__/change/" data-popup="yes" title="Change selected language">
												<img src="/static/admin/img/icon-changelink.svg" alt="Change">
											</a>
											<a class="related-widget-wrapper-link add-related" id="add_id_foreign" data-popup="yes" href="/config/language/add/" title="Add another language">
												<img src="/static/admin/img/icon-addlink.svg" alt="Add">
											</a>
											<a class="related-widget-wrapper-link delete-related" id="delete_id_foreign" data-href-template="/config/language/__fk__/delete/" data-popup="yes" title="Delete selected language">
												<img src="/static/admin/img/icon-deletelink.svg" alt="Delete">
											</a>
											<a class="related-widget-wrapper-link view-related" id="view_id_foreign" data-href-template="/config/language/__fk__/change/?_to_field=id" title="View selected language">
												<img src="/static/admin/img/icon-viewlink.svg" alt="View">
											</a>
										</div>
									</div>
								</div>
								<div class="form-row field-description">
									<div>
										<label for="id_description">Description:</label>
										{{ formA.description|as_crispy_field }}
									</div>
								</div>
								<div class="form-row field-image">
									<div>
										<label>Image:</label>
										<div class="readonly"></div>
									</div>
								</div>
								<div class="form-row field-img">
									<div>
										<label for="id_img">Img:</label>
										{{ formA.img|as_crispy_field }}
									</div>
								</div>
								<div class="form-row field-is_active">
									<div class="checkbox-row">
										{{ formA.is_active|as_crispy_field }}
										<label class="vCheckboxLabel" for="id_is_active"></label>
									</div>
								</div>
							</fieldset>

							<div class="js-inline-admin-formset inline-group relative flex flex-col min-w-0 break-words w-full my-6 shadow-lg rounded bg-white dark:bg-sky-900 overflow-scroll" id="words-group" data-inline-type="tabular" data-inline-formset="{&quot;name&quot;: &quot;#words&quot;, &quot;options&quot;: {&quot;prefix&quot;: &quot;words&quot;, &quot;addText&quot;: &quot;Add another Word&quot;, &quot;deleteText&quot;: &quot;Remove&quot;}}">
								<div class="p-3">

									<label for="bulk-set-level" class="block mb-3 text-lg">Bulk set level to selected words</label>
									<div class="flex">
										<div>
											<select id="bulk-set-level" name="bulk-set-level">
												<option value="">Select level</option>
												{% for level in get_level %}
												<option value="{{ level.id }}">
												{{ level }}
												</option>
												{% endfor %}
											</select>
										</div>
										<div class="pl-6">
											<button type="button" id="perform-bulk-set-level" data-course-id="" class="bg-green-500 text-white py-2 px-4">Set Level</button>
										</div>
									</div>
								</div>

								<div class="tabular inline-related last-related">
									<fieldset class="module">
										<h2 class="px-3">Words</h2>
										<table>
											<thead>
												<tr>
													<th>Bulk</th>
													<th class="column-word required">Foreign</th>
													<th class="column-description required">Native</th>
													<th class="column-level">Level</th>
													<th class="column-is_active">Is active</th>
													<th>Delete?</th>
												</tr>
											</thead>
											<tbody>
												{% if total_level == 0 %}
												<tr class="form-row wordFormset">
													{% for item in word_formset.forms %}
													<td>
														<input type="checkbox" name="select-bulk" value="">
													</td>
													<td class="field-word">
														{{ item.word|as_crispy_field }}
													</td>
													<td class="field-description">
														{{ item.description|as_crispy_field }}
													</td>
													<td class="field-level">
														<div class="related-widget-wrapper" data-model-ref="level">
															<select id="bulk-set-level" name="bulk-set-level">
																<option value="">Select level</option>
																{% for level in get_level %}
																<option value="{{ level.id }}">
																{{ level }}
																</option>
																{% endfor %}
															</select>
															<a class="related-widget-wrapper-link change-related" data-href-template="/course/level/__fk__/change/" data-popup="yes" title="Change selected level">
																<img src="/static/admin/img/icon-changelink.svg" alt="Change">
															</a>
															<a class="related-widget-wrapper-link add-related" data-popup="yes" href="/course/level/add/" title="Add another level">
																<img src="/static/admin/img/icon-addlink.svg" alt="Add">
															</a>
															<a class="related-widget-wrapper-link delete-related" data-href-template="/course/level/__fk__/delete/" data-popup="yes" title="Delete selected level">
																<img src="/static/admin/img/icon-deletelink.svg" alt="Delete">
															</a>
															<a class="related-widget-wrapper-link view-related" data-href-template="/course/level/__fk__/change/?_to_field=id" title="View selected level">
																<img src="/static/admin/img/icon-viewlink.svg" alt="View">
															</a>
														</div>
													</td>
													<td class="field-is_active">
														{{ item.is_active|as_crispy_field }}
													</td>
													<td class="delCourse"></td>
													{% endfor %}
												</tr>
												<tr class="addCourse" style="padding-left: 10px;display: inline-block;"></tr>
												{% else %}
												<tr class="form-row wordFormset">
													{% for item in word_formset.forms %}
													<td>
														<input type="checkbox" name="select-bulk" value="">
													</td>
													<td class="field-word">
														{{ item.word|as_crispy_field }}
													</td>
													<td class="field-description">
														{{ item.description|as_crispy_field }}
													</td>
													<td class="field-level">
														<div class="related-widget-wrapper" data-model-ref="level">
															<select id="bulk-set-level" name="bulk-set-level">
																<option value="">Select level</option>
																{% for level in get_level %}
																<option value="{{ level.id }}">
																{{ level }}
																</option>
																{% endfor %}
															</select>
															<a class="related-widget-wrapper-link change-related" data-href-template="/course/level/__fk__/change/" data-popup="yes" title="Change selected level">
																<img src="/static/admin/img/icon-changelink.svg" alt="Change">
															</a>
															<a class="related-widget-wrapper-link add-related" data-popup="yes" href="/course/level/add/" title="Add another level">
																<img src="/static/admin/img/icon-addlink.svg" alt="Add">
															</a>
															<a class="related-widget-wrapper-link delete-related" data-href-template="/course/level/__fk__/delete/" data-popup="yes" title="Delete selected level">
																<img src="/static/admin/img/icon-deletelink.svg" alt="Delete">
															</a>
															<a class="related-widget-wrapper-link view-related" data-href-template="/course/level/__fk__/change/?_to_field=id" title="View selected level">
																<img src="/static/admin/img/icon-viewlink.svg" alt="View">
															</a>
														</div>
													</td>
													<td class="field-is_active">
														{{ item.is_active|as_crispy_field }}
													</td>
													<td class="delCourse"></td>
													{% endfor %}
												</tr>
												<tr class="addCourse" style="padding-left: 10px;display: inline-block;"></tr>
												{% endif %}
											</tbody>
										</table>
									</fieldset>
								</div>
							</div>

							<div class="submit-row">
								<input type="submit" value="Save" class="default" name="_save">
							</div>

							{% endif %}

						</div>
					</form>
				</div>
				<br class="clear"/>
			</div>
		</div>
	</div>
</main>
{% endblock content %}


{% block extra_javascript %}
<script src="{% static 'js/jquery.formset.js' %}" type="text/javascript"></script>
<script type='text/javascript'>
$(document).ready(function()
{
	var urls = "/course/add/";

	$('select[name=native]').on('change', function(e)
	{
		e.preventDefault();

		var get_selected_native = $('select[name=native] option').filter(':selected').val();
		// console.log("course get_selected_native: ", get_selected_native);
		console.log("get_selected_native1: ", get_selected_native);

		$.ajax(
        {
        	type: 'GET',
        	url: urls,
        	data:
        	{
        		'get_selected_native':get_selected_native,
        		// 'csrfmiddlewaretoken': csrftoken,
        	},
        	success: function(data)
        	{
        		if(!data["valid"])
        		{
        			console.log("get_selected_native2", get_selected_native);
        		}
        	},
        });
	})

	$('select[name=foreign]').on('change', function()
	{
		var get_selected_foreign = $('select[name=foreign] option').filter(':selected').val();
		console.log("get_selected_foreign: ", get_selected_foreign);
	})

	$(function()
    {
        // $('.wordFormset').formset();
        $('.wordFormset').formset({
            // prefix: 'course_formset',
            addCssClass: 'btn btn-success',
            addText: '<i class="fas fa-plus"></i>',
            deleteCssClass: 'btn btn-danger',
            deleteText: '<i class="fas fa-minus"></i>',
            // keepFieldValues: '#id_course_formset-0-word, #id_course_formset-0-description',
            deleteContainerClass: 'delCourse',
            addContainerClass: 'addCourse',
        })
    });

});
</script>
{% endblock %}
